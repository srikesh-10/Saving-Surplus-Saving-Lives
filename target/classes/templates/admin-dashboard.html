<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NGO Food Donation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <style>
    :root {
        --primary: #7f5af0;
        --primary-2: #00e5ff;
        --bg: #0f172a;
        --bg-2: #1e293b;
        --glass: rgba(255,255,255,0.08);
        --shadow: 0 8px 24px rgba(127, 90, 240, 0.3);
        --text: #ffffff;
    }

    body {
        color: var(--text);
        background: radial-gradient(1200px 600px at 10% 10%, rgba(127,90,240,.15), transparent 60%),
                    radial-gradient(800px 500px at 90% 20%, rgba(0,229,255,.15), transparent 60%),
                    linear-gradient(135deg, var(--bg), var(--bg-2));
        font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        min-height: 100vh;
    }

    .text-muted { color: rgba(255,255,255,0.7) !important; }
    .table, .table td, .table th { color: var(--text); }
    .table thead { background: rgba(127,90,240,0.15); color: var(--text); }
    .table tbody tr:hover { background-color: rgba(255,255,255,0.05); }

    .dashboard-container { padding: 20px; }

    .header-card {
        background: var(--glass);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
    }

    .stats-card {
        color: #fff;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-align: center;
    }

    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 16px 36px rgba(127,90,240,0.4);
    }

    .stats-card i { font-size: 3rem; opacity: 0.85; }
    .stats-card h3 { font-size: 2.5rem; font-weight: bold; margin: 15px 0 5px 0; }
    .stats-card p { font-size: 1rem; opacity: 0.9; margin: 0; }

    /* Gradient colors for individual stats cards */
    .stats-card:nth-child(1) { background: linear-gradient(135deg, #7f5af0 0%, #00e5ff 100%); }
    .stats-card:nth-child(2) { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .stats-card:nth-child(3) { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .stats-card:nth-child(4) { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .stats-card:nth-child(5) { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .stats-card:nth-child(6) { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
    .stats-card:nth-child(7) { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }

    .content-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; box-shadow: var(--shadow); }

    .btn-danger {
        background: linear-gradient(45deg, #ff416c, #ff4b2b);
        border: none;
        transition: transform 0.2s ease;
    }
    .btn-danger:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(255,65,108,0.4); }

    .btn-logout {
        background: linear-gradient(135deg, #7f5af0 0%, #00e5ff 100%);
        border: none;
        color: #fff;
        padding: 10px 22px;
        border-radius: 14px;
        box-shadow: var(--shadow);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-logout:hover { transform: translateY(-2px); box-shadow: 0 16px 32px rgba(127,90,240,0.45); }

    .status-badge.status-available { background: #10b981; color: #fff; }
    .status-badge.status-accepted { background: #f59e0b; color: #fff; }
    .status-badge.status-completed { background: #7f5af0; color: #fff; }

    .nav-tabs .nav-link { background: rgba(255,255,255,0.05); color: #00e5ff; font-weight: 600; }
    .nav-tabs .nav-link.active { background: linear-gradient(135deg, #7f5af0 0%, #00e5ff 100%); color: #fff; }

    .user-type-badge { padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
    .badge-donor { background: #8b5cf6; color: #fff; }
    .badge-volunteer { background: #10b981; color: #fff; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .content-card { animation: fadeIn 0.5s ease-out; }
</style>

</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="mb-2">
                        <i class="fas fa-user-shield" style="color: #667eea;"></i>
                        Admin Dashboard
                    </h1>
                    <p class="text-muted mb-0">Welcome back, <strong th:text="${user.name}">Admin</strong></p>
                </div>
                <form action="/logout" method="post" style="margin: 0;">
                    <button type="submit" class="btn btn-logout">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </button>
                </form>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="stats-card">
                    <i class="fas fa-users"></i>
                    <h3 th:text="${totalUsers}">0</h3>
                    <p>Total Users</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-hand-holding-heart"></i>
                    <h3 th:text="${totalDonations}">0</h3>
                    <p>Total Donations</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-box"></i>
                    <h3 th:text="${totalQuantity}">0</h3>
                    <p>Total Food Items</p>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-heart"></i>
                    <h3 th:text="${totalPeopleHelped}">0</h3>
                    <p>People Helped</p>
                </div>
            </div>
        </div>

        <!-- Additional Stats Row -->
        <div class="row">
            <div class="col-md-4">
                <div class="stats-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <i class="fas fa-donate"></i>
                    <h3 th:text="${totalDonors}">0</h3>
                    <p>Total Donors</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    <i class="fas fa-hands-helping"></i>
                    <h3 th:text="${totalVolunteers}">0</h3>
                    <p>Total Volunteers</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333;">
                    <i class="fas fa-check-circle"></i>
                    <h3 th:text="${completedDonations}">0</h3>
                    <p>Completed Donations</p>
                </div>
            </div>
        </div>

        <!-- Tabbed Content -->
        <div class="content-card">
            <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">
                        <i class="fas fa-users me-2"></i>Users Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="donations-tab" data-bs-toggle="tab" data-bs-target="#donations" type="button">
                        <i class="fas fa-hand-holding-heart me-2"></i>Donations Management
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="adminTabsContent">
                <!-- Users Tab -->
                <div class="tab-pane fade show active" id="users" role="tabpanel">
                    <h4 class="mb-3">All Users</h4>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Type</th>
                                    <th>Address</th>
                                    <th>Stats</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="u : ${donors}">
                                    <td th:text="${u.id}">1</td>
                                    <td th:text="${u.name}">John Doe</td>
                                    <td th:text="${u.email}">john@example.com</td>
                                    <td th:text="${u.phone}">123-456-7890</td>
                                    <td><span class="user-type-badge badge-donor">DONOR</span></td>
                                    <td th:text="${u.address}">123 Main St</td>
                                    <td>
                                        <small class="text-muted">-</small>
                                    </td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" th:onclick="'deleteUser(' + ${u.id} + ')'">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr th:each="v : ${volunteers}">
                                    <td th:text="${v.id}">2</td>
                                    <td th:text="${v.name}">Jane Smith</td>
                                    <td th:text="${v.email}">jane@example.com</td>
                                    <td th:text="${v.phone}">098-765-4321</td>
                                    <td><span class="user-type-badge badge-volunteer">VOLUNTEER</span></td>
                                    <td th:text="${v.address}">456 Oak Ave</td>
                                    <td>
                                        <small>
                                            <strong th:text="${v.totalDeliveries}">0</strong> deliveries<br>
                                            <strong th:text="${v.peopleHelped}">0</strong> people helped
                                        </small>
                                    </td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" th:onclick="'deleteUser(' + ${v.id} + ')'">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Donations Tab -->
                <div class="tab-pane fade" id="donations" role="tabpanel">
                    <h4 class="mb-3">All Donations</h4>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Food Type</th>
                                    <th>Quantity</th>
                                    <th>Pickup Address</th>
                                    <th>Status</th>
                                    <th>Donor ID</th>
                                    <th>Volunteer ID</th>
                                    <th>Created At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="d : ${allDonations}">
                                    <td th:text="${d.id}">1</td>
                                    <td th:text="${d.foodType}">Rice</td>
                                    <td th:text="${d.quantity}">50</td>
                                    <td th:text="${d.pickupAddress}">123 Main St</td>
                                    <td>
                                        <span th:class="${'status-badge status-' + #strings.toLowerCase(d.status)}" 
                                              th:text="${d.status}">AVAILABLE</span>
                                    </td>
                                    <td th:text="${d.donorId}">1</td>
                                    <td th:text="${d.volunteerId != null ? d.volunteerId : '-'}">-</td>
                                    <td th:text="${#temporals.format(d.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</td>
                                    <td>
                                        <button class="btn btn-danger btn-sm" th:onclick="'deleteDonation(' + ${d.id} + ')'">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" referrerpolicy="no-referrer"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.gsap) {
                gsap.registerPlugin(ScrollTrigger);

                // Header and stats entrance
                gsap.from('.header-card', { y: -30, opacity: 0, duration: 0.8, ease: 'power3.out' });
                gsap.from('.stats-card', { opacity: 0, y: 20, duration: 0.6, stagger: 0.1, ease: 'power2.out', delay: 0.2 });

                // Animated counters
                document.querySelectorAll('.stats-card h3').forEach(function (el) {
                    var end = parseInt((el.textContent || '0').replace(/[^0-9]/g, '')) || 0;
                    el.textContent = '0';
                    gsap.to(el, { innerText: end, duration: 1.2, ease: 'power1.out', snap: { innerText: 1 }, delay: 0.3 });
                });

                // Tab content transition on show
                document.querySelectorAll('#adminTabs button[data-bs-toggle="tab"]').forEach(function (btn) {
                    btn.addEventListener('shown.bs.tab', function () {
                        var targetSel = btn.getAttribute('data-bs-target');
                        var target = document.querySelector(targetSel);
                        if (target) gsap.from(target, { opacity: 0, y: 10, duration: 0.4, ease: 'power2.out' });
                    });
                });
            }
        });

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch('/admin/delete-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'userId=' + encodeURIComponent(userId)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('User deleted successfully!');
                        location.reload();
                    } else {
                        alert('Failed to delete user: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the user.');
                });
            }
        }

        function deleteDonation(donationId) {
            if (confirm('Are you sure you want to delete this donation?')) {
                fetch('/admin/delete-donation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'donationId=' + encodeURIComponent(donationId)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('Donation deleted successfully!');
                        location.reload();
                    } else {
                        alert('Failed to delete donation: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the donation.');
                });
            }
        }
    </script>
</body>
</html>
